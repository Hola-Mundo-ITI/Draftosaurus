<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Sistema de Dados - Draftosaurus</title>
    <link rel="stylesheet" href="CSS/styles.css">
    <link rel="stylesheet" href="CSS/digitalPage.css">
    <style>
        body {
            background-color: #f5f5dc;
            font-family: 'Papyrus', fantasy;
            margin: 0;
            padding: 20px;
        }
        
        .contenedor-prueba {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .titulo-prueba {
            text-align: center;
            color: #3b2d15;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .controles-prueba {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .boton-prueba {
            background-color: #6b4f28;
            color: #fffce2;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-family: 'Papyrus', fantasy;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .boton-prueba:hover {
            background-color: #8b5e34;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .info-prueba {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .log-prueba {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .zona-simulacion {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .zona-test {
            background: #e8f4f8;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .zona-test:hover {
            background: #d5e8f0;
            transform: scale(1.02);
        }
        
        .zona-test.permitida {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .zona-test.restringida {
            background: #f8d7da;
            border-color: #dc3545;
        }
        
        .zona-test h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .zona-test p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="contenedor-prueba">
        <h1 class="titulo-prueba">üé≤ Prueba del Sistema de Dados</h1>
        
        <div class="info-prueba">
            <h3>üìã Instrucciones de Prueba</h3>
            <p>Esta p√°gina permite probar el sistema de dados implementado para Draftosaurus:</p>
            <ul>
                <li><strong>Lanzar Dado:</strong> Simula el lanzamiento del dado para una ronda</li>
                <li><strong>Cambiar Jugador:</strong> Alterna entre jugador 1 y 2 para probar restricciones</li>
                <li><strong>Probar Validaci√≥n:</strong> Hace clic en las zonas para probar la validaci√≥n</li>
                <li><strong>Ver Estado:</strong> Muestra el estado actual del sistema</li>
            </ul>
        </div>
        
        <div class="controles-prueba">
            <button class="boton-prueba" onclick="lanzarDadoPrueba()">üé≤ Lanzar Dado</button>
            <button class="boton-prueba" onclick="cambiarJugadorPrueba()">üë§ Cambiar Jugador</button>
            <button class="boton-prueba" onclick="mostrarEstadoPrueba()">üìä Ver Estado</button>
            <button class="boton-prueba" onclick="reiniciarPrueba()">üîÑ Reiniciar</button>
            <button class="boton-prueba" onclick="limpiarLog()">üóëÔ∏è Limpiar Log</button>
        </div>
        
        <div id="log-prueba" class="log-prueba">
            <div>üéÆ Sistema de dados cargado. Haz clic en "Lanzar Dado" para comenzar.</div>
        </div>
        
        <div class="zona-simulacion">
            <div class="zona-test" data-zona="bosque-semejanza" onclick="probarZona(this)">
                <h4>üå≤ Bosque de la Semejanza</h4>
                <p>Mismo tipo de dinosaurio</p>
            </div>
            <div class="zona-test" data-zona="trio-frondoso" onclick="probarZona(this)">
                <h4>üåø Tr√≠o Frondoso</h4>
                <p>Exactamente 3 dinosaurios</p>
            </div>
            <div class="zona-test" data-zona="prado-diferencia" onclick="probarZona(this)">
                <h4>üåæ Prado de la Diferencia</h4>
                <p>Todos diferentes</p>
            </div>
            <div class="zona-test" data-zona="pradera-amor" onclick="probarZona(this)">
                <h4>üíï Pradera del Amor</h4>
                <p>Parejas del mismo tipo</p>
            </div>
            <div class="zona-test" data-zona="isla-solitaria" onclick="probarZona(this)">
                <h4>üèùÔ∏è Isla Solitaria</h4>
                <p>Solo un dinosaurio</p>
            </div>
            <div class="zona-test" data-zona="rey-selva" onclick="probarZona(this)">
                <h4>üëë Rey de la Selva</h4>
                <p>El m√°s grande</p>
            </div>
            <div class="zona-test" data-zona="dinos-rio" onclick="probarZona(this)">
                <h4>üåä Dinosaurios en el R√≠o</h4>
                <p>En secuencia</p>
            </div>
        </div>
    </div>

    <!-- Scripts del sistema -->
    <script src="JS/tablero/ManejadorDado.js"></script>
    <script src="JS/utils/validadorDado.js"></script>
    <script src="JS/tablero/ValidadorZona.js"></script>
    <script src="JS/tablero/EstadoJuego.js"></script>

    <script>
        // Variables globales para la prueba
        let manejadorDado;
        let validadorDado;
        let validadorZona;
        let estadoJuego;
        let jugadorActual = 1;
        let rondaActual = 1;

        // Inicializar sistema de prueba
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSistemaPrueba();
        });

        function inicializarSistemaPrueba() {
            try {
                // Crear instancias
                validadorZona = new ValidadorZona();
                estadoJuego = new EstadoJuego();
                manejadorDado = new ManejadorDado();
                validadorDado = new ValidadorDado(manejadorDado);
                
                // Hacer disponibles globalmente
                window.manejadorDado = manejadorDado;
                window.validadorDado = validadorDado;
                window.validadorZona = validadorZona;
                window.estadoJuego = estadoJuego;
                
                log('‚úÖ Sistema de dados inicializado correctamente');
                log('üìù Jugador actual: ' + jugadorActual);
                log('üìù Ronda actual: ' + rondaActual);
                
            } catch (error) {
                log('‚ùå Error al inicializar: ' + error.message);
                console.error(error);
            }
        }

        function lanzarDadoPrueba() {
            try {
                const estadoDado = manejadorDado.lanzarDadoParaRonda(rondaActual, 2);
                
                log(`üé≤ Dado lanzado para ronda ${rondaActual}:`);
                log(`   Cara: ${estadoDado.caraActual} (${manejadorDado.reglasDado[estadoDado.caraActual].nombre})`);
                log(`   Jugador que lanz√≥: ${estadoDado.jugadorQueLanzo}`);
                log(`   Descripci√≥n: ${estadoDado.descripcionRestriccion}`);
                
                // Actualizar interfaz visual
                actualizarZonasPrueba();
                
                // Mostrar estado del dado en la interfaz
                mostrarEstadoDadoPrueba(estadoDado);
                
            } catch (error) {
                log('‚ùå Error al lanzar dado: ' + error.message);
            }
        }

        function cambiarJugadorPrueba() {
            jugadorActual = jugadorActual === 1 ? 2 : 1;
            log(`üë§ Cambiado a Jugador ${jugadorActual}`);
            actualizarZonasPrueba();
        }

        function probarZona(elemento) {
            const zonaId = elemento.dataset.zona;
            const dinosaurioTest = { tipo: 'triceratops' };
            const dinosauriosEnZona = [];
            
            try {
                // Probar validaci√≥n del dado
                const validacionDado = validadorDado.validarRestriccionDado(
                    zonaId, 
                    dinosauriosEnZona, 
                    dinosaurioTest, 
                    jugadorActual, 
                    estadoJuego.obtenerEstado()
                );
                
                log(`üß™ Prueba en ${zonaId}:`);
                log(`   Jugador: ${jugadorActual}`);
                log(`   V√°lido: ${validacionDado.valido ? '‚úÖ' : '‚ùå'}`);
                log(`   Raz√≥n: ${validacionDado.razon}`);
                
                if (validacionDado.exento) {
                    log(`   ‚≠ê Jugador exento (lanz√≥ el dado)`);
                }
                
            } catch (error) {
                log('‚ùå Error en prueba: ' + error.message);
            }
        }

        function mostrarEstadoPrueba() {
            const estadoDado = manejadorDado.obtenerEstado();
            const info = validadorDado.obtenerInfoRestriccionActual();
            
            log('üìä Estado actual del sistema:');
            
            if (estadoDado && estadoDado.activo) {
                log(`   üé≤ Dado activo: ${estadoDado.caraActual}`);
                log(`   üìç Ronda: ${estadoDado.rondaActual}`);
                log(`   üë§ Jugador que lanz√≥: ${estadoDado.jugadorQueLanzo}`);
                log(`   üìù Restricci√≥n: ${estadoDado.descripcionRestriccion}`);
                
                if (info) {
                    const zonasPermitidas = validadorDado.obtenerZonasPermitidas(jugadorActual, estadoJuego.obtenerEstado());
                    log(`   üéØ Zonas permitidas para jugador ${jugadorActual}: ${zonasPermitidas.join(', ')}`);
                }
            } else {
                log('   üé≤ No hay dado activo');
            }
            
            // Mostrar estad√≠sticas
            const stats = manejadorDado.obtenerEstadisticas();
            log(`   üìà Lanzamientos totales: ${stats.totalLanzamientos}`);
            log(`   üìä Conteo de caras: ${JSON.stringify(stats.conteoCaras)}`);
        }

        function actualizarZonasPrueba() {
            const zonas = document.querySelectorAll('.zona-test');
            const estadoJuegoActual = estadoJuego.obtenerEstado();
            
            zonas.forEach(zona => {
                const zonaId = zona.dataset.zona;
                zona.classList.remove('permitida', 'restringida');
                
                // Verificar si la zona est√° permitida por el dado
                const permitida = validadorDado.zonaPermitidaPorDado(zonaId, jugadorActual, estadoJuegoActual);
                
                if (permitida) {
                    zona.classList.add('permitida');
                } else {
                    zona.classList.add('restringida');
                }
            });
        }

        function mostrarEstadoDadoPrueba(estadoDado) {
            // Crear o actualizar interfaz del dado
            let contenedorDado = document.getElementById('contenedor-dado');
            
            if (!contenedorDado) {
                contenedorDado = document.createElement('div');
                contenedorDado.id = 'contenedor-dado';
                contenedorDado.className = 'dado-container';
                document.body.appendChild(contenedorDado);
            }
            
            const regla = manejadorDado.reglasDado[estadoDado.caraActual];
            const esJugadorQueLanza = estadoDado.jugadorQueLanzo === jugadorActual;
            
            contenedorDado.innerHTML = `
                <div id="estado-dado" class="dado-estado">
                    <div class="dado-resultado ${esJugadorQueLanza ? 'jugador-libre' : 'jugador-restringido'}" style="--color-cara: ${regla.color}">
                        <div class="cara-dado">${regla.icono}</div>
                        <div class="info-dado">
                            <h3>üé≤ ${esJugadorQueLanza ? '¬°Lanzaste el dado!' : 'Restricci√≥n del Dado'}</h3>
                            <p><strong>${regla.nombre}</strong></p>
                            <p class="${esJugadorQueLanza ? 'privilegio' : 'descripcion'}">
                                ${esJugadorQueLanza ? '‚ú® Puedes colocar donde quieras' : regla.descripcion}
                            </p>
                        </div>
                    </div>
                </div>
                <div id="info-ronda" class="ronda-info">
                    <span class="ronda-numero">Ronda ${estadoDado.rondaActual}</span>
                    <span class="jugador-turno">Jugador ${jugadorActual} ${esJugadorQueLanza ? '(Lanz√≥ el dado)' : '(Restringido)'}</span>
                </div>
            `;
        }

        function reiniciarPrueba() {
            try {
                manejadorDado.reiniciar();
                jugadorActual = 1;
                rondaActual = 1;
                
                // Limpiar interfaz del dado
                const contenedorDado = document.getElementById('contenedor-dado');
                if (contenedorDado) {
                    contenedorDado.remove();
                }
                
                // Limpiar estilos de zonas
                document.querySelectorAll('.zona-test').forEach(zona => {
                    zona.classList.remove('permitida', 'restringida');
                });
                
                log('üîÑ Sistema reiniciado');
                log('üìù Jugador actual: ' + jugadorActual);
                log('üìù Ronda actual: ' + rondaActual);
                
            } catch (error) {
                log('‚ùå Error al reiniciar: ' + error.message);
            }
        }

        function limpiarLog() {
            document.getElementById('log-prueba').innerHTML = '<div>üóëÔ∏è Log limpiado</div>';
        }

        function log(mensaje) {
            const logElement = document.getElementById('log-prueba');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.textContent = `[${timestamp}] ${mensaje}`;
            logElement.appendChild(div);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Funci√≥n para probar todas las caras del dado
        function probarTodasLasCaras() {
            const caras = ['bosque', 'llanura', 'banos', 'cafeteria', 'vacio', 'trex'];
            
            log('üß™ Probando todas las caras del dado:');
            
            caras.forEach(cara => {
                // Simular estado del dado
                manejadorDado.estadoActual = {
                    rondaActual: rondaActual,
                    caraActual: cara,
                    jugadorQueLanzo: 2, // Para que jugador 1 est√© restringido
                    descripcionRestriccion: manejadorDado.reglasDado[cara].descripcion,
                    activo: true,
                    fechaLanzamiento: new Date()
                };
                
                log(`   üé≤ ${cara}: ${manejadorDado.reglasDado[cara].nombre}`);
                
                // Probar cada zona
                const zonas = ['bosque-semejanza', 'trio-frondoso', 'prado-diferencia', 'pradera-amor', 'isla-solitaria', 'rey-selva', 'dinos-rio'];
                zonas.forEach(zonaId => {
                    const validacion = validadorDado.validarRestriccionDado(
                        zonaId, 
                        [], 
                        { tipo: 'triceratops' }, 
                        1, 
                        estadoJuego.obtenerEstado()
                    );
                    
                    if (validacion.valido) {
                        log(`      ‚úÖ ${zonaId}`);
                    } else {
                        log(`      ‚ùå ${zonaId}: ${validacion.razon}`);
                    }
                });
            });
        }

        // Agregar funci√≥n de prueba completa al objeto global
        window.probarTodasLasCaras = probarTodasLasCaras;
    </script>
</body>
</html>